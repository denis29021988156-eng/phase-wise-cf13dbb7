# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ PhaseWise - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üéØ –û–±–∑–æ—Ä

PhaseWise –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ "Gaia" –¥–ª—è –ø–æ–º–æ—â–∏ –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–æ–±—ã—Ç–∏–π —Å —É—á–µ—Ç–æ–º –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞.

### –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ AI-–∞–Ω–∞–ª–∏–∑–µ

**–í—Å–µ AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç:**
- ‚úÖ **–í–æ–∑—Ä–∞—Å—Ç** (age) - –¥–ª—è –≤–æ–∑—Ä–∞—Å—Ç–Ω—ã—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
- ‚úÖ **–†–æ—Å—Ç** (height) - –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ **–í–µ—Å** (weight) - –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
- `ai-chat` - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≤–µ—Ç–æ–≤ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `generate-ai-suggestion` - —É—á–µ—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ –æ—Ü–µ–Ω–∫–µ —Å–æ–±—ã—Ç–∏–π
- `ai-week-planner` - –æ—Ü–µ–Ω–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏
- `predict-wellness` - —Ç–æ—á–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è
- `ai-generate-email-preview` - –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∏—Å–µ–º

---

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø (2025-01-15)

### 1. ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ Google –∏ Microsoft Event ID
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `microsoft_event_id` –≤ —Ç–∞–±–ª–∏—Ü—É `events`
- Google —Å–æ–±—ã—Ç–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç `google_event_id`
- Microsoft/Outlook —Å–æ–±—ã—Ç–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç `microsoft_event_id`
- –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –æ–±–æ–∏—Ö –ø–æ–ª–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è ID

**–ú–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.**

---

### 2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ Cron Jobs
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

#### –ê–∫—Ç–∏–≤–Ω—ã–µ Cron Jobs:

**`ai-week-planner-daily`** - –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00 UTC (12:00 –ú–°–ö)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é –≤–ø–µ—Ä–µ–¥
- –°–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É –≤—Å—Ç—Ä–µ—á —Å —É—á–µ—Ç–æ–º —Ñ–∞–∑—ã —Ü–∏–∫–ª–∞
- –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**`cleanup-ai-logs-daily`** - –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00 UTC
- –£–¥–∞–ª—è–µ—Ç retry –ª–æ–≥–∏ —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π
- –û—á–∏—â–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
- –£–¥–∞–ª—è–µ—Ç resolved —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π

**`cleanup-rate-limits-hourly`** - –ö–∞–∂–¥—ã–π —á–∞—Å
- –£–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å–∏ rate limiting —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞

**`cleanup-rejected-suggestions-weekly`** - –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 3:00 UTC
- –£–¥–∞–ª—è–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:**
```sql
SELECT * FROM cron.job;
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–π:**
```sql
SELECT * FROM cron.job_run_details 
ORDER BY start_time DESC LIMIT 10;
```

---

### 3. ‚úÖ Rate Limiting –¥–ª—è AI-–∑–∞–ø—Ä–æ—Å–æ–≤
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

#### –õ–∏–º–∏—Ç—ã –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º:
| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–∞–∫—Å. –∑–∞–ø—Ä–æ—Å–æ–≤ | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ |
|----------|----------------|----------------|
| `ai-chat` | 30 | 1 –º–∏–Ω—É—Ç–∞ |
| `ai-week-planner` | 10 | 1 –º–∏–Ω—É—Ç–∞ |
| `generate-ai-suggestion` | 20 | 1 –º–∏–Ω—É—Ç–∞ |
| `ai-generate-email-preview` | 15 | 1 –º–∏–Ω—É—Ç–∞ |
| `ai-handle-event-move` | 10 | 1 –º–∏–Ω—É—Ç–∞ |

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `api_rate_limits` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
2. –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∫ AI –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `checkRateLimit()`
3. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 429 (Too Many Requests)
4. –ó–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
   - `X-RateLimit-Remaining`: –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤
   - `X-RateLimit-Reset`: –≤—Ä–µ–º—è —Å–±—Ä–æ—Å–∞ –ª–∏–º–∏—Ç–∞ (unix timestamp)

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤:**
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª `supabase/functions/_shared/rate-limiter.ts`:
```typescript
const DEFAULT_LIMITS: Record<string, RateLimitConfig> = {
  'ai-chat': { maxRequests: 30, windowMs: 60000 },
  // ... –¥—Ä—É–≥–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
};
```

---

### 4. ‚ö†Ô∏è Leaked Password Protection
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Supabase Dashboard ‚Üí Authentication](https://supabase.com/dashboard/project/pytefsexxwtlropzkmxi/auth/providers)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **Policies**
3. –ù–∞–π–¥–∏—Ç–µ **"Password Strength and Leaked Password Protection"**
4. –í–∫–ª—é—á–∏—Ç–µ –æ–ø—Ü–∏—é **"Check for leaked passwords"**
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—é:
   - ‚úÖ –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
   - ‚úÖ –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞  
   - ‚úÖ –•–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ü–∏—Ñ—Ä–∞
   - ‚úÖ –•–æ—Ç—è –±—ã –æ–¥–∏–Ω —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª

**–°—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:**
https://supabase.com/docs/guides/auth/password-security#password-strength-and-leaked-password-protection

---

## üìã –ö–û–ú–ü–û–ù–ï–ù–¢–´ –°–ò–°–¢–ï–ú–´

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `events` - —Å–æ–±—ã—Ç–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è (Google/Microsoft)
- `event_move_suggestions` - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è AI –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É
- `chat_messages` - –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ —Å Gaia
- `user_cycles` - –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—Å—Ç—Ä—É–∞–ª—å–Ω–æ–≥–æ —Ü–∏–∫–ª–∞
- `ai_retry_logs` - –ª–æ–≥–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- `ai_operation_metrics` - –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ AI
- `ai_error_notifications` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- `api_rate_limits` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤

### Edge Functions

**`ai-week-planner`** (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ, cron)
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å –Ω–∞ 7 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
- –°–æ–∑–¥–∞–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –ø–µ—Ä–µ–Ω–æ—Å—É —Å–æ–±—ã—Ç–∏–π
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∞–∑—É —Ü–∏–∫–ª–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

**`ai-chat`** (–ø–æ –∑–∞–ø—Ä–æ—Å—É)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- Rate limiting: 30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ –ë–î

**`ai-handle-event-move`** (–ø–æ –∑–∞–ø—Ä–æ—Å—É)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
- Rate limiting: 10 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Gmail –∏ Microsoft Graph API

**`ai-generate-email-preview`** (–ø–æ –∑–∞–ø—Ä–æ—Å—É)  
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç preview –ø–∏—Å—å–º–∞ —á–µ—Ä–µ–∑ OpenAI
- Rate limiting: 15 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

**`generate-ai-suggestion`** (–ø–æ –∑–∞–ø—Ä–æ—Å—É)
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–≤–µ—Ç—ã –¥–ª—è —Å–æ–±—ã—Ç–∏–π
- Rate limiting: 20 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì

### AI Monitoring Dashboard
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ **`/ai-monitoring`** –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ AI –æ–ø–µ—Ä–∞—Ü–∏–π (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π)
- ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- ‚úÖ –°—Ä–µ–¥–Ω–∏–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ Success rate
- ‚úÖ –†–∞–∑–±–∏–≤–∫–∞ –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π

### SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ü–æ—Å–ª–µ–¥–Ω–∏–µ retry –ø–æ–ø—ã—Ç–∫–∏:**
```sql
SELECT * FROM ai_retry_logs 
ORDER BY created_at DESC LIMIT 50;
```

**–ú–µ—Ç—Ä–∏–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞:**
```sql
SELECT operation_type, 
       COUNT(*) as total,
       AVG(execution_time_ms) as avg_time_ms,
       COUNT(*) FILTER (WHERE status = 'success') as success_count
FROM ai_operation_metrics 
WHERE created_at > NOW() - INTERVAL '1 day'
GROUP BY operation_type;
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ (–Ω–µ resolved):**
```sql
SELECT * FROM ai_error_notifications 
WHERE severity IN ('high', 'critical') 
  AND resolved = false
ORDER BY created_at DESC;
```

**–¢–µ–∫—É—â–∏–µ rate limits:**
```sql
SELECT user_id, endpoint, request_count, window_start 
FROM api_rate_limits 
WHERE window_start > NOW() - INTERVAL '5 minutes'
ORDER BY request_count DESC;
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç 1: Rate Limiting
```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å 35 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ (–ª–∏–º–∏—Ç 30/–º–∏–Ω)
for i in {1..35}; do
  curl -X POST https://pytefsexxwtlropzkmxi.supabase.co/functions/v1/ai-chat \
    -H "Authorization: Bearer YOUR_TOKEN" \
    -H "Content-Type: application/json" \
    -d '{"message":"test","userId":"YOUR_USER_ID"}'
  echo "Request $i"
done
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü–æ—Å–ª–µ 30 –∑–∞–ø—Ä–æ—Å–æ–≤ - –æ—Ç–≤–µ—Ç 429 —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ rate limit

### –¢–µ—Å—Ç 2: Cron Job (—Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫)
```bash
curl -X POST https://pytefsexxwtlropzkmxi.supabase.co/functions/v1/ai-week-planner \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB5dGVmc2V4eHd0bHJvcHprbXhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1MjIxOTEsImV4cCI6MjA3NDA5ODE5MX0.fPbLIqM08fdMuAO2vQO5mj-Zt3yBpTmmUXrwAV5fWg0"
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤ `event_move_suggestions`, —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ

### –¢–µ—Å—Ç 3: Microsoft Event ID
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Microsoft —Å–æ–±—ã—Ç–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
SELECT id, title, source, google_event_id, microsoft_event_id 
FROM events 
WHERE source = 'outlook'
LIMIT 5;
```
**–û–∂–∏–¥–∞–µ—Ç—Å—è:** `microsoft_event_id` –∑–∞–ø–æ–ª–Ω–µ–Ω, `google_event_id` = NULL

---

## üîß TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limit —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ

**–†–µ—à–µ–Ω–∏–µ 1:** –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç—ã
```typescript
// supabase/functions/_shared/rate-limiter.ts
'ai-chat': { maxRequests: 50, windowMs: 60000 }
```

**–†–µ—à–µ–Ω–∏–µ 2:** –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤—Ä—É—á–Ω—É—é
```sql
DELETE FROM api_rate_limits WHERE window_start < NOW() - INTERVAL '1 hour';
```

### –ü—Ä–æ–±–ª–µ–º–∞: Cron job –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 1:** –†–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã?
```sql
SELECT * FROM pg_extension WHERE extname IN ('pg_cron', 'pg_net');
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 2:** Job —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
```sql
SELECT * FROM cron.job WHERE jobname LIKE '%planner%';
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ 3:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏
```sql
SELECT * FROM cron.job_run_details 
WHERE jobid = (SELECT jobid FROM cron.job WHERE jobname = 'ai-week-planner-daily')
ORDER BY start_time DESC LIMIT 5;
```

### –ü—Ä–æ–±–ª–µ–º–∞: Microsoft —Å–æ–±—ã—Ç–∏—è –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –¢–æ–∫–µ–Ω—ã –∞–∫—Ç—É–∞–ª—å–Ω—ã?
```sql
SELECT user_id, provider, expires_at, 
       (expires_at < NOW()) as is_expired
FROM user_tokens 
WHERE provider = 'microsoft';
```

### –ü—Ä–æ–±–ª–µ–º–∞: AI –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

**–ß–µ–∫-–ª–∏—Å—Ç:**
1. ‚úÖ OpenAI API key –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Supabase Secrets
2. ‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ —Ü–∏–∫–ª–∞ (`user_cycles`)
3. ‚úÖ –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å —Å–æ–±—ã—Ç–∏—è –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ edge function
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `ai_error_notifications`

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ **–í–∫–ª—é—á–∏—Ç—å Leaked Password Protection** (—Å–º. —Ä–∞–∑–¥–µ–ª 4)
2. üìä **–°–ª–µ–¥–∏—Ç—å –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏** –Ω–∞ `/ai-monitoring`
3. üîç **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å rate limits** - –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
4. üîî **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
5. üß™ **–ü—Ä–æ–≤–µ—Å—Ç–∏ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** rate limiting

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò


- [Supabase Dashboard](https://supabase.com/dashboard/project/pytefsexxwtlropzkmxi)
- [Edge Functions](https://supabase.com/dashboard/project/pytefsexxwtlropzkmxi/functions)
- [Database Cron Jobs](https://supabase.com/dashboard/project/pytefsexxwtlropzkmxi/database/cron)
- [Authentication Settings](https://supabase.com/dashboard/project/pytefsexxwtlropzkmxi/auth/providers)
- [AI Monitoring Dashboard](/ai-monitoring)
- [Supabase Cron Docs](https://supabase.com/docs/guides/database/extensions/pg_cron)
- [Gmail API Docs](https://developers.google.com/gmail/api)
- [Microsoft Graph Docs](https://learn.microsoft.com/en-us/graph/)
- [OpenAI API Docs](https://platform.openai.com/docs)

---

## üèÅ –ß–ï–ö–õ–ò–°–¢ –ì–û–¢–û–í–ù–û–°–¢–ò

- [x] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] Event ID: —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –¥–ª—è Google/Microsoft
- [x] Cron Jobs: –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã
- [x] Rate Limiting: –∞–∫—Ç–∏–≤–Ω–æ
- [ ] **Password Protection: –¢–†–ï–ë–£–ï–¢–°–Ø –í–ö–õ–Æ–ß–ò–¢–¨ –í–†–£–ß–ù–£–Æ**
- [x] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: dashboard –¥–æ—Å—Ç—É–ø–µ–Ω
- [x] Edge Functions: –∑–∞–¥–µ–ø–ª–æ–µ–Ω—ã

**–û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –≤–∫–ª—é—á–∏—Ç—å Leaked Password Protection –≤—Ä—É—á–Ω—É—é –≤ Supabase Dashboard!**

–£–¥–∞—á–∏! üöÄ

